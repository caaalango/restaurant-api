<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Cardápio {{.Title}}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .category { margin-bottom: 3em; }
        .category h2 { border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        .category ul { display: flex; flex-wrap: nowrap; overflow-x: auto; padding: 0; margin: 0; list-style: none; gap: 10px; }
        .item { display: flex; flex-direction: column; background: #f9f9f9; border: 1px solid #ddd; border-radius: 5px; min-width: 300px; flex: 0 0 300px; cursor: pointer; }
        .item:hover { background: #f0f0f0; }
        .item img { width: 100%; height: 150px; object-fit: cover; border-top-left-radius: 5px; border-top-right-radius: 5px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; }
        .modal-content { background: #fff; border-radius: 10px; max-width: 400px; width: 100%; padding: 20px; position: relative; max-height: 80vh; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Cardápio: {{.Title}}</h1>
    <h2>{{.Slogo}}</h2>
    {{range .Categories}}
    <div class="category">
        <h2>{{.Category}}</h2>
        <ul>
            {{range .Dishes}}
            <li class="item" 
                data-name="{{.Dish.Name}}" 
                data-description="{{.Dish.Description}}" 
                data-full-description="{{.Dish.FullDescription}}" 
                data-image-url="{{.Dish.ImageURL}}"
                data-comments-json='{{.Comments}}'
                data-rating-dist-json='{{.Dish.RatingDistJSON}}'>
                <img src="{{.Dish.ImageURL}}" alt="{{.Dish.Name}}">
                <div class="item-content">
                    <span class="item-name">{{.Dish.Name}}</span>
                    <span class="item-price">R$ {{printf "%.2f" .Dish.Price}}</span>
                    <span class="item-desc">{{.Dish.Description}}</span>
                </div>
            </li>
            {{end}}
        </ul>
    </div>
    {{end}}
    <div class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <img class="modal-image" src="" alt="Prato">
            <div class="modal-title"></div>
            <div class="modal-full-description"></div>
            <div class="modal-rating-dist">
                <h3>Distribuição de notas</h3>
                <ul class="rating-dist-list"></ul>
            </div>
            <div class="modal-comments">
                <h3>Comentários</h3>
                <ul class="comments-list"></ul>
            </div>
        </div>
    </div>
    <script>
        const overlay = document.querySelector('.modal-overlay');
        const modalTitle = document.querySelector('.modal-title');
        const modalFullDescription = document.querySelector('.modal-full-description');
        const modalImage = document.querySelector('.modal-image');
        const modalCommentsBox = document.querySelector('.modal-comments .comments-list');
        const modalRatingDistBox = document.querySelector('.modal-rating-dist .rating-dist-list');
        const closeModalBtn = document.querySelector('.modal-close');

        document.querySelectorAll('.item').forEach(item => {
            item.addEventListener('click', () => {
                const name = item.getAttribute('data-name');
                const fullDescription = item.getAttribute('data-full-description') || item.getAttribute('data-description');
                const imageUrl = item.getAttribute('data-image-url');
                const commentsJSON = item.getAttribute('data-comments-json');
                const ratingDistJSON = item.getAttribute('data-rating-dist-json');

                modalTitle.textContent = name;
                modalFullDescription.textContent = fullDescription;
                modalImage.src = imageUrl;

                const ratingDist = JSON.parse(ratingDistJSON);
                modalRatingDistBox.innerHTML = '';
                Object.keys(ratingDist).forEach(key => {
                    const stars = '★'.repeat(parseInt(key)) + '☆'.repeat(5 - parseInt(key));
                    const li = document.createElement('li');
                    li.textContent = `${stars}: ${ratingDist[key]} votos`;
                    modalRatingDistBox.appendChild(li);
                });

                const comments = JSON.parse(commentsJSON);
                modalCommentsBox.innerHTML = '';
                comments.forEach(comment => {
                    const li = document.createElement('li');
                    li.classList.add('comment-container');

                    const userName = document.createElement('div');
                    userName.classList.add('comment-user');
                    userName.textContent = comment.User;

                    const ratingEl = document.createElement('div');
                    ratingEl.classList.add('comment-rating');
                    ratingEl.textContent = '★'.repeat(comment.Rating) + '☆'.repeat(5 - comment.Rating);

                    const textEl = document.createElement('div');
                    textEl.classList.add('comment-text');
                    textEl.textContent = comment.Text;

                    li.appendChild(userName);
                    li.appendChild(ratingEl);
                    li.appendChild(textEl);
                    modalCommentsBox.appendChild(li);
                });

                overlay.style.display = 'flex';
            });
        });

        closeModalBtn.addEventListener('click', () => overlay.style.display = 'none');
        overlay.addEventListener('click', e => { if (e.target === overlay) overlay.style.display = 'none'; });
    </script>
</body>
</html>
